<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <title>Order Bill and Recipe</title>
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <meta content="Free HTML Templates" name="keywords">
    <meta content="Free HTML Templates" name="description">
    <link href="source/img/favicon.ico" rel="icon">
    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@400;500;700&display=swap" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.10.0/css/all.min.css" rel="stylesheet">
    <link href="lib/animate/" rel="stylesheet">
    <link href="lib/owlcarousel/assets/owl.carousel.min.css" rel="stylesheet">
    <style>
        body {
            font-family: Arial, sans-serif;
        }

        .container {
            max-width: 800px;
            margin-top: 50px;
            margin-bottom: 50px;
            margin-left: 50px;
            padding: 20px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }

        .font-th {
            font-size: 13px;
        }

        .section {
            margin-right: 5px;
            display: flex;
            flex-wrap: wrap;
            justify-content: space-between;
        }

        .section-header {
            font-weight: bold;
            font-size: 18px;
            margin-bottom: 10px;
            flex-basis: 100%;
        }

        .field-label {
            font-weight: bold;
            padding: 4px;
            width: 120px;
        }

        .data-value {
            padding: 4px;
            background-color: #ffffff;
            border-radius: 4px;
        }

        .right-align-title {
            text-align: right;
            margin-bottom: 5px;
        }

        .bottom_ {
            margin-top: 10px;
        }

        .right-align-total {
            text-align: right;
        }

        .right-align-shipvia {
            text-align: left;
        }
        
        .data-only {
            color: #000000;
        }

        .product-space {
            margin-bottom: 0px;
        }

        .product-info span {
            margin-right: 40px;
        }

        .product-row {
            display: flex;
            align-items: center;
        }

        .product-price {
            margin-right: 0px;
            margin-left: auto;
            text-align: left;
        }
        .order-section {
            margin-left: 300px;
        }
    </style>
</head>

<body>
    <div class="container font-th">
        <div class="right-align-title">
            <h2 class="section-header">Order Information</h2>
            <div>
                <div>Order Number:<span id="orderID" class="data-value data-only"></span></div>
            </div>
            <div>
                <div>Order Date:<span id="orderDate" class="data-value data-only"></span></div>
            </div>
            <div>
                <div>Customer ID:<span id="customerID" class="data-value data-only"></span></div>
            </div>
        </div>
        <hr>
        <div class="section">
            <h2 class="section-header">Name</h2>
            <div>ชื่อผู้ทำรายการ</div>
            <div id="username" class="data-value data-only"></div>
            <!-- <div>Ship Via</div>
            <div id="shipVia"></div> -->
        </div>
        <hr>
        <div class="section">
            <h2 class="section-header">Address</h2>
            <div>ชื่อ</div>
            <div id="shipName"></div>
            <div>ที่อยู่</div>
            <div id="shipAddress"></div>
            <div>จังหวัด</div>
            <div id="shipCity"></div>
            <div>เขต</div>
            <div id="shipRegion"></div>
            <div>รหัสไปรษณีย์</div>
            <div id="shipPostalCode"></div>
            <div>ประเทศ</div>
            <div id="shipCountry"></div>
        </div>
        <hr>
        <div class="section">
            <h2 class="section-header">Order</h2>
            <div class="order-section">
                <div id="productsContainer"></div>
            </div>
        </div>
        <div class="bottom_">
            <div class="right-align-shipvia">
                <div>ชำระค่าสินค้าด้วย</div>
                <div id="shipVia"></div>
            </div>
            <div class="right-align-total">
                <div>Total</div>
                <div id="total"></div>
            </div>
        </div>
        <hr>
    </div>

    <script>
        document.addEventListener("DOMContentLoaded", function () {
            fetchJSON();
        });

        function fetchJSON() {
            fetch('data.json')
                .then(response => response.json())
                .then(data => populateHTML(data))
                .catch(error => {
                    console.error('Error:', error);
                    createJSON();
                });
        }

        function populateHTML(data) {
            document.getElementById('orderID').textContent = data.OrderID;
            document.getElementById('customerID').textContent = data.CustomerID;
            document.getElementById('username').textContent = data.Username;
            document.getElementById('orderDate').textContent = data.OrderDate;
            document.getElementById('shipAddress').textContent = data.ShipAddress;
            document.getElementById('shipCity').textContent = data.ShipCity;
            document.getElementById('shipRegion').textContent = data.ShipRegion;
            document.getElementById('shipPostalCode').textContent = data.ShipPostalCode;
            document.getElementById('shipCountry').textContent = data.ShipCountry;
            document.getElementById('shipName').textContent = data.ShipName;
            document.getElementById('shipVia').textContent = data.ShipVia;

            const productsContainer = document.getElementById('productsContainer');
            productsContainer.innerHTML = ''; // Clear previous product list

            let total = 0; // Initialize total price

            data.Products.forEach((product, index) => {
                const productRow = document.createElement('div');
                productRow.className = 'product-row';

                const productInfo = document.createElement('div');
                productInfo.className = 'product-info';
                productInfo.innerHTML = `${index + 1}. ${product.ProductID} ${product.ProductName}<br><span style="margin-left: 250px">${product.ProductSize} จำนวน ${product.ProductQuality} สี ${product.ProductColor}</span><hr>`;
                productRow.appendChild(productInfo);

                productRow.appendChild(productInfo);

                const productPrice = document.createElement('div');
                productPrice.className = 'product-price';
                productPrice.textContent = product.ProductPrice.toFixed(2) + ' บาท';
                productRow.appendChild(productPrice);

                total += product.ProductQuality * product.ProductPrice; // Calculate product price

                productsContainer.appendChild(productRow);
            });
            document.getElementById('total').textContent = total.toFixed(2); // Display total price
        }

        function createJSON() {
            const defaultData = {
                OrderID: 'none',
                CustomerID: 'N/A',
                Username: 'Unknown',
                OrderDate: 'N/A',
                ShippedDate: 'N/A',
                ShipAddress: 'N/A',
                ShipCity: 'N/A',
                ShipRegion: 'N/A',
                ShipPostalCode: 'N/A',
                ShipCountry: 'N/A',
                ShipName: 'N/A',
                ShipVia: 'N/A',
                ProductID: 'N/A',
                ProductName: 'N/A',
                ProductQuality: 'N/A',
                ProductSize: 'N/A',
                ProductColor: 'N/A',
                ProductPrice: 'N/A',
                Total: 'N/A'
            };

            populateHTML(defaultData);

            const jsonData = JSON.stringify(defaultData, null, 2);
            const blob = new Blob([jsonData], { type: 'application/json' });

            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'data.json';
            link.click();
        }
    </script>
</body>

</html>